<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Catálogo Digital Belcorp - Precios en USD</title>
    <style>
        body { margin: 0; padding: 0; }
        iframe {
            width: 100%;
            height: 100vh;
            border: none;
            position: fixed;
            top: 0;
            left: 0;
        }
    </style>
</head>
<body>
    <iframe id="catalogFrame" src="https://catalogodigital.somosbelcorp.com/CO?consultant=OTkwNzQ5NzcyNg==" frameborder="0"></iframe>
    <script>
        // Esperar a que el iframe cargue
        document.getElementById('catalogFrame').onload = function() {
            const frame = this;
            try {
                // Inyectar el código de conversión en el iframe
                const script = frame.contentWindow.document.createElement('script');
                script.textContent = `
                    // Configuración
                    const CONFIG = {
                        TASA_CAMBIO: 3100,
                        PORCENTAJE_NORMAL: 0.40,
                        PORCENTAJE_PESO_ALTO: 0.80,
                        LIMITE_PESO_ML: 700
                    };

                    // Función para convertir precios a dólares
                    function convertirADolares(precioEnPesos, pesoEnMl = 0) {
                        const precioBaseDolares = precioEnPesos / CONFIG.TASA_CAMBIO;
                        const porcentaje = (pesoEnMl > CONFIG.LIMITE_PESO_ML) ? 
                            CONFIG.PORCENTAJE_PESO_ALTO : 
                            CONFIG.PORCENTAJE_NORMAL;
                        const precioFinal = precioBaseDolares + (precioBaseDolares * porcentaje);
                        return Math.round(precioFinal * 100) / 100;
                    }

                    // Función para extraer el peso del producto
                    function extraerPesoProducto(descripcion) {
                        const match = descripcion.match(/(\d+)\\s*ml/i);
                        return match ? parseInt(match[1]) : 0;
                    }

                    // Forzar vista móvil
                    const userAgent = 'Mozilla/5.0 (Linux; Android 11; Pixel 5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.91 Mobile Safari/537.36';
                    Object.defineProperty(navigator, 'userAgent', {
                        get: function () { return userAgent; }
                    });

                    // Observer para detectar y modificar los precios
                    const observer = new MutationObserver((mutations) => {
                        mutations.forEach((mutation) => {
                            if (mutation.type === 'childList' || mutation.type === 'characterData') {
                                const precios = document.querySelectorAll('.product-price, .price');
                                precios.forEach((elemento) => {
                                    if (!elemento.hasAttribute('data-converted')) {
                                        const textoOriginal = elemento.textContent;
                                        const precioNumerico = parseFloat(textoOriginal.replace(/[^\\d]/g, ''));
                                        
                                        if (!isNaN(precioNumerico)) {
                                            const descripcionProducto = elemento.closest('.product-item')?.querySelector('.product-description')?.textContent || '';
                                            const pesoProducto = extraerPesoProducto(descripcionProducto);
                                            
                                            const precioDolares = convertirADolares(precioNumerico, pesoProducto);
                                            elemento.textContent = '$' + precioDolares.toFixed(2) + ' USD';
                                            elemento.setAttribute('data-converted', 'true');
                                        }
                                    }
                                });
                            }
                        });
                    });

                    // Iniciar observación cuando el documento esté listo
                    document.addEventListener('DOMContentLoaded', () => {
                        observer.observe(document.body, {
                            childList: true,
                            subtree: true,
                            characterData: true
                        });
                        
                        // Conversión inicial
                        const precios = document.querySelectorAll('.product-price, .price');
                        precios.forEach((elemento) => {
                            const textoOriginal = elemento.textContent;
                            const precioNumerico = parseFloat(textoOriginal.replace(/[^\\d]/g, ''));
                            
                            if (!isNaN(precioNumerico)) {
                                const descripcionProducto = elemento.closest('.product-item')?.querySelector('.product-description')?.textContent || '';
                                const pesoProducto = extraerPesoProducto(descripcionProducto);
                                
                                const precioDolares = convertirADolares(precioNumerico, pesoProducto);
                                elemento.textContent = '$' + precioDolares.toFixed(2) + ' USD';
                                elemento.setAttribute('data-converted', 'true');
                            }
                        });
                    });
                `;
                frame.contentWindow.document.head.appendChild(script);
            } catch (error) {
                console.error('Error al inyectar el script:', error);
            }
        };
    </script>
</body>
</html>
